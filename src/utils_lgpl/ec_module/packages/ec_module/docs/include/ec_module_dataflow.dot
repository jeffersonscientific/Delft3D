/**
 * @file ec_module_dataflow.dot
 * @brief EC-Module Data Flow Diagram
 * @details Shows the complete data processing pipeline within EC-Module
 * 
 * To generate diagram in Doxygen, use:
 * @dot
 * digraph ec_dataflow {
 *     // Include this file content
 * }
 * @enddot
 */

digraph ec_module_dataflow {
    // Graph attributes
    rankdir=LR;
    bgcolor="white";
    fontname="Arial";
    fontsize=12;
    
    // INTERACTIVE FEATURES: All boxes contain clickable links (URL attributes) 
    // that navigate directly to relevant source code files in the repository.
    // Use with Doxygen or GraphViz tools that support URL navigation.
    
    // Node styling
    node [shape=box, style=filled, fontname="Arial", fontsize=9];
    edge [fontname="Arial", fontsize=8];
    
    // Data sources
    subgraph cluster_sources {
        label="Data Sources";
        style=filled;
        fillcolor="lightgray";
        
        netcdf_files [label="NetCDF Files\nGrid Data\nTime Series", fillcolor="lightblue", URL="../../../../../../examples/"];
        ascii_files [label="ASCII Files\nBoundary Conditions\nMeteorolog", fillcolor="lightgreen", URL="../../../../../../examples/"];
        bc_files [label="BC Files\nForcing Data\nParameters", fillcolor="lightyellow", URL="../../../../../../examples/"];
    }
    
    // File readers
    subgraph cluster_readers {
        label="File Readers";
        style=filled;
        fillcolor="orange";
        
        nc_reader [label="NetCDF Reader\necNetcdfInit\necNetcdfRead", fillcolor="orange", URL="../../src/ec_filereader.F90"];
        ascii_reader [label="ASCII Reader\necBCInit\necBCRead", fillcolor="orange", URL="../../src/ec_filereader.F90"];
        multi_reader [label="Multi-file Reader\necFieldCreate", fillcolor="orange", URL="../../src/ec_field.f90"];
    }
    
    // EC-Module core processing
    subgraph cluster_core {
        label="EC-Module Core";
        style=filled;
        fillcolor="red";
        
        ec_instance [label="EC Instance\ntEcInstance\nItem Management", fillcolor="red", fontcolor="white", URL="../../src/ec_instance.f90"];
        field_manager [label="Field Manager\ntEcField\nData Structure", fillcolor="red", fontcolor="white", URL="../../src/ec_field.f90"];
        connection_mgr [label="Connection Manager\ntEcConnection\nLink Management", fillcolor="red", fontcolor="white", URL="../../src/ec_connection.f90"];
    }
    
    // Interpolation engine
    subgraph cluster_interpolation {
        label="Spatial Interpolation";
        style=filled;
        fillcolor="green";
        
        triangulation [label="Triangulation\necTriangulationCreate\nDelaunay Triangles", fillcolor="lightgreen", URL="../../src/ec_basic_interpolation.f90"];
        bilinear [label="Bilinear\necBilinearInterpolation\nGrid-based", fillcolor="lightgreen", URL="../../src/ec_basic_interpolation.f90"];
        averaging [label="Averaging\necAveraging\nPoint-to-Grid", fillcolor="lightgreen", URL="../../src/ec_basic_interpolation.f90"];
        kdtree [label="KD-Tree\necKDTreeCreate\nNearest Neighbor", fillcolor="lightgreen", URL="../../../../../../third_party_open/kdtree2"];
    }
    
    // Target processing
    subgraph cluster_targets {
        label="Target Models";
        style=filled;
        fillcolor="purple";
        
        dflowfm_data [label="D-Flow FM\nMeteorology\nBoundaries", fillcolor="lightcoral", URL="../../../../../../engines_gpl/dflowfm/packages/dflowfm_kernel/src/dflowfm_kernel/timespace/meteo1.f90"];
        dwaq_data [label="D-Water Quality\nFlow Data\nConcentrations", fillcolor="lightcoral", URL="../../../../../../engines_gpl/waq"];
        morph_data [label="D-Morphology\nVelocities\nSediment", fillcolor="lightcoral", URL="../../../../../../engines_gpl/morphology"];
        wave_data [label="D-Waves\nWind\nWater Levels", fillcolor="lightcoral", URL="../../../../../../engines_gpl/wave"];
    }
    
    // Data flow connections
    netcdf_files -> nc_reader [label="read"];
    ascii_files -> ascii_reader [label="parse"];
    bc_files -> multi_reader [label="load"];
    
    nc_reader -> ec_instance [label="register"];
    ascii_reader -> field_manager [label="create fields"];
    multi_reader -> connection_mgr [label="setup connections"];
    
    ec_instance -> triangulation [label="coordinate\nmapping"];
    field_manager -> bilinear [label="grid\ninterpolation"];
    connection_mgr -> averaging [label="point\naggregation"];
    ec_instance -> kdtree [label="spatial\nsearch"];
    
    triangulation -> dflowfm_data [label="interpolated\nmeteorology"];
    bilinear -> dwaq_data [label="flow\nfields"];
    averaging -> morph_data [label="sediment\ntransport"];
    kdtree -> wave_data [label="boundary\nforcing"];
    
    // Time synchronization (across all interpolation methods)
    time_sync [label="Time Synchronization\n|ecTimeInterpolation", shape=ellipse, fillcolor="yellow"];
    
    triangulation -> time_sync [style=dashed, label="temporal"];
    bilinear -> time_sync [style=dashed, label="temporal"];
    averaging -> time_sync [style=dashed, label="temporal"];
    kdtree -> time_sync [style=dashed, label="temporal"];
    
    // Title
    labelloc="t";
    label="EC-Module Data Processing Pipeline";
}